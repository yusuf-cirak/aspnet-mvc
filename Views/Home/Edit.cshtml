                    @model StudentManagement.ViewModels.StudentCreateOrUpdateViewModel
                    @using Newtonsoft.Json;
                        <div class="card container text-center justify-content">
                            <form asp-antiforgery="false"  id="editForm">
                                @* <input type="hidden" asp-for="@Model.Id" id='Id' value='@Model.Id' /> *@
                                <input type="hidden" asp-for="Student.Id" id='EditId' />
                                <div class="form-group mt-3">
                                    <label class="control-label text-center">Ad Soyad</label>
                                    <input readonly asp-for="Student.FullName" id="EditFullName" name="FullName" value="" class="form-control text-center" />

                                </div>

                                <div class="form-group mt-3">
                                    <label class="control-label">Bölüm</label>
                                    <br />
                                    @* <select asp-for="DepartmentId" id='DepartmentId' class="select form-control text-center"> *@
                                    <select asp-for="Student.DepartmentId" id='EditDepartmentId' value="" name="EditDepartmentId" class="select form-control text-center">
                                        @foreach (var department in Model.Departments)
                                        {
                                                <option value="@department.Id" hidden disabled>@department.Name</option>
                                        }
                                    </select>
                                </div>

                                <div class="form-group mt-3">
                                    <label class="control-label">Hobiler</label>
                                    <br />
                                    <select asp-for="Student.Hobbies" id="edit-multi-select-hobby" name="HobbyNames[]" class="form-control text-center EditHobbyNames" multiple="multiple">
                                        @foreach (var hobby in Model.Hobbies)
                                        {
                                                <option value="@hobby.Id" hidden disabled>@hobby.Name</option>
                                        }
                                    </select>
                                </div>

                                <div class="form-group mt-3">
                                    <label class="control-label">Sınıf Öğretmeni</label>
                                    <br />

                                    <select asp-for="Student.ClassTeacherId" name="EditClassTeacherId" id='EditClassTeacherId' class="select text-center form-control">

                                       @foreach (var classTeacher in Model.ClassTeachers)
                                        {
                                                <option value="@classTeacher.Id" hidden disabled>@classTeacher.FullName</option>
                                        }
                                    </select>
                                </div>

                                <div class="form-group mt-3">
                                    <label class="control-label">Rehber Öğretmeni</label>
                                    <br />
                                    <select asp-for="Student.MentorTeacherId" id='EditMentorTeacherId' name="EditMentorTeacherId" class="select form-control text-center">
                                        @foreach (var mentorTeacher in Model.MentorTeachers)
                                        {
                                                <option value="@mentorTeacher.Id" hidden disabled>@mentorTeacher.FullName</option>
                                        }
                                    </select>
                                </div>
                                <div class="form-group mt-3">
                                    <input type="submit" disabled id="editBtn" value="Save" class="btn btn-primary form-control btn-update" />
                                </div>
                            </form>
                        </div>


                        <script type="text/javascript">

                         var inputFullName=$('input#EditFullName');
                         var departmentSelects=$('select#EditDepartmentId option')
                        var classTeacherSelects=$('select#EditClassTeacherId option')
                         var mentorTeacherSelects=$('select#EditMentorTeacherId option')
                        var hobbyMultipleSelects=$('#edit-multi-select-hobby option')





                         // update student fields by clicking details button
                            $(document).ready(function (){
                                $('[id*=btnDetails]').on('click', function () {
                        $.ajax({
                    url: '@Url.Action("edit", "home")',
                    dataType: "html",
                    data: { "id": $(this).attr('name') },
                    type: "GET",
                    contentType: "application/json",
                    success: function (response) {
                        response=JSON.parse(response);


                         $('input#EditId').attr('value',response.id);


                         inputFullName.removeAttr('readonly');

                         inputFullName.val(response.fullName)
                         

                         $(departmentSelects).each(function(i){
                            $(departmentSelects)[i].removeAttribute('hidden')
                            $(departmentSelects)[i].removeAttribute('disabled')

                         })
                    
                        var selectedDepartment=$("select#EditDepartmentId option[value="+response.departmentId+"]").val();
                        $('select#EditDepartmentId').val(selectedDepartment)

                         $(classTeacherSelects).each(function(i){
                            $(classTeacherSelects)[i].removeAttribute('hidden')

                            $(classTeacherSelects)[i].removeAttribute('disabled')

                         })
                        var selectedClassTeacher=$("select#EditClassTeacherId option[value="+response.classTeacherId+"]").val();
                        $('select#EditClassTeacherId').val(selectedDepartment)


                         $(mentorTeacherSelects).each(function(i){
                            $(mentorTeacherSelects)[i].removeAttribute('hidden')
                            $(mentorTeacherSelects)[i].removeAttribute('disabled')
                         })
                         
                        var selectedMentorTeacher=$("select#EditMentorTeacherId option[value="+response.mentorTeacherId+"]").val();
                        $('select#EditMentorTeacherId').val(selectedMentorTeacher)

                         $(hobbyMultipleSelects).each(function(){
                            $(this).removeAttr('hidden')
                            $(this).removeAttr('disabled')
                         })


                          $(response.hobbies).each(function(i){
                            $(`#edit-multi-select-hobby option[value="`+response.hobbies[i].id+`"]`).prop('selected',true)
                         })



                        $('#editBtn').removeAttr('disabled')

                        },
                        error: function (err) {
                        toastr.error(err.responseText);
                    }
                    })
                    
                });
            });
                        </script>
                            <script type="text/javascript">
                            var formInputsChanged = false;

                            $(document).ready(function () {
                                $('input, select').change(function () {
                                    formInputsChanged = true;
                                })
                            })

                            $(document).ready(function(){
                                $('#editBtn').click(function(e){
                                    e.preventDefault();
                                    if(formInputsChanged){
                                        var hobbyIds=[];
                                        var selectedHobbyNames=$('#edit-multi-select-hobby option:selected');
                                        $(selectedHobbyNames).each(function(i,e){
                                            hobbyIds.push(selectedHobbyNames[i].value);
                                        })

                                        
                         


                                        var studentData={
                                            id:$('input#EditId').val(),
                                            fullName:$('#EditFullName').val(),
                                            departmentId:$('select#EditDepartmentId').val(),
                                            hobbyIds:hobbyIds,
                                            classTeacherId:$('select#EditClassTeacherId').val(),
                                            mentorTeacherId:$('select#EditMentorTeacherId').val()
                                        }

                         inputFullName.attr('readonly')
                         inputFullName.attr("value","")
                         inputFullName.val("")

                            $('#editBtn').attr('disabled','true')




                         $(departmentSelects).each(function(i){
                            $(departmentSelects)[i].setAttribute('hidden','true')
                            $(departmentSelects)[i].setAttribute('disabled','true') 

                         })

                         $('select#EditDepartmentId').val('')

                         $(classTeacherSelects).each(function(i){
                            $(classTeacherSelects)[i].setAttribute('hidden','true')
                            $(classTeacherSelects)[i].setAttribute('disabled','true')

                         })
                         $('select#EditClassTeacherId').val('')


                          $(mentorTeacherSelects).each(function(i){
                            $(mentorTeacherSelects)[i].setAttribute('hidden','true')
                            $(mentorTeacherSelects)[i].setAttribute('disabled','true')
                         })
                         $('select#EditMentorTeacherId').val('')

                          $(hobbyMultipleSelects).each(function(i){
                            $(hobbyMultipleSelects)[i].setAttribute('hidden','true')
                            $(hobbyMultipleSelects)[i].setAttribute('disabled','true')
                            $(hobbyMultipleSelects)[i].setAttribute('selected','false')
                         })

                                         jsonData=JSON.stringify(studentData);


                                            $.ajax({
                                                url: "/home/edit",
                                                type: "POST",
                                                dataType: "html",
                                                contentType: "application/json; charset=utf-8",
                                                data: jsonData,
                                                success: function (res) {
                                                    $('table#myTable').remove();
                                                    $('div.list-partial').html(res);

                                                    toastr.success("Öğrenci verisi başarıyla güncellendi!");
                                                },
                                                error: function (err) {
                                                    toastr.error("Öğrenci verisi güncellenirken bir sorun oluştu");     

                                                }
                                            }); 
                                    }

                                    else toastr.warning("Herhangi bir değişiklik yapmadınız, lütfen bir değişiklik yaptıktan sonra butona tıklayınız!")
                                })
                            })

                            </script>
